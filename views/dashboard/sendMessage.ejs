<div class="page-heading d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
	<div class="animate-fade-in">
		<h3 class="mb-1 fw-bold">Broadcast Center</h3>
		<p class="text-muted mb-0">Send messages, media, and interactive buttons.</p>
	</div>
	<nav aria-label="breadcrumb" class="animate-fade-in" style="animation-delay: 0.1s;">
		<ol class="breadcrumb mb-0">
			<li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
			<li class="breadcrumb-item active" aria-current="page">Send Message</li>
		</ol>
	</nav>
</div>

<div class="page-content">
	<%- include('../layouts/alert') %>

		<!-- Hero Section -->
		<div class="message-hero animate-fade-in" style="animation-delay: 0.2s;">
			<div class="d-flex flex-wrap justify-content-between align-items-center gap-4">
				<div style="z-index: 1;">
					<span class="badge mb-3 text-uppercase tracking-wider"><i
							class="fa-solid fa-paper-plane me-2"></i>Message Composer</span>
					<h2 class="fw-bold mb-2">Choose Your Message Type</h2>
					<p class="mb-0 opacity-90">Select a format below to start sending messages to your customers.</p>
				</div>
				<div style="z-index: 1;">
					<div class="p-3 rounded-4" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);">
						<small class="text-uppercase opacity-75 d-block mb-1">Active Session</small>
						<div class="fw-bold font-monospace fs-5">
							<%= Array.isArray(session) && session.length ? session[0].session_name : 'No Active Session'
								%>
						</div>
					</div>
				</div>
			</div>
		</div>

		<section id="content-types" class="animate-fade-in" style="animation-delay: 0.3s;">
			<div class="row g-4 align-items-stretch">
				<!-- Text Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon text"><i class="fa-solid fa-font"></i></span>
								<div>
									<h5 class="card-title mb-0">Text Message</h5>
									<small class="text-muted">Basic text & mentions</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send simple text messages. Supports WhatsApp
								formatting (*bold*, _italic_, ~strike~).</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" onclick="alertSendText()">
								<i class="fa-solid fa-paper-plane"></i> Send Text
							</button>
						</div>
					</div>
				</div>

				<!-- Media Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon media"><i class="fa-solid fa-image"></i></span>
								<div>
									<h5 class="card-title mb-0">Media Message</h5>
									<small class="text-muted">Photos, Videos, Docs</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send images, videos, or documents with an optional
								caption.</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" onclick="alertSendMedia()">
								<i class="fa-solid fa-photo-film"></i> Send Media
							</button>
						</div>
					</div>
				</div>

				<!-- Button Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon list"><i class="fa-solid fa-square-check"></i></span>
								<div>
									<h5 class="card-title mb-0">Interactive Buttons</h5>
									<small class="text-muted">Quick replies & URLs</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send messages with up to 3 clickable buttons, call
								actions, or URL links.</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" type="button" data-bs-toggle="collapse"
								data-bs-target="#collapseButtons">
								<i class="fa-solid fa-sliders"></i> Configure
							</button>
						</div>
					</div>
				</div>

				<!-- List Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon list"><i class="fa-solid fa-list-ul"></i></span>
								<div>
									<h5 class="card-title mb-0">List Message</h5>
									<small class="text-muted">Menu selection</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send a menu with up to 20 selectable options. Great
								for customer service menus.</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" type="button" data-bs-toggle="collapse"
								data-bs-target="#collapseList">
								<i class="fa-solid fa-sliders"></i> Configure
							</button>
						</div>
					</div>
				</div>

				<!-- Location Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon location"><i class="fa-solid fa-map-location-dot"></i></span>
								<div>
									<h5 class="card-title mb-0">Location</h5>
									<small class="text-muted">Share coordinates</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send precise location coordinates (Latitude &
								Longitude).</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" onclick="alertSendLocation()">
								<i class="fa-solid fa-map-pin"></i> Send Location
							</button>
						</div>
					</div>
				</div>

				<!-- Contact Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon text"><i class="fa-solid fa-address-card"></i></span>
								<div>
									<h5 class="card-title mb-0">Contact Card</h5>
									<small class="text-muted">vCard sharing</small>
								</div>
							</div>
							<p class="card-text text-muted small">Share one or multiple contacts directly to the user.
							</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" onclick="alertSendContact()">
								<i class="fa-solid fa-address-book"></i> Send Contact
							</button>
						</div>
					</div>
				</div>

				<!-- Sticker Message -->
				<div class="col-xl-4 col-md-6 col-sm-12">
					<div class="card send-card h-100">
						<div class="card-body">
							<div class="d-flex align-items-center mb-3">
								<span class="feature-icon media"><i class="fa-solid fa-note-sticky"></i></span>
								<div>
									<h5 class="card-title mb-0">Sticker</h5>
									<small class="text-muted">Custom stickers</small>
								</div>
							</div>
							<p class="card-text text-muted small">Send stickers from images with custom pack name and
								author.</p>
						</div>
						<div class="card-footer bg-transparent border-0 pt-0">
							<button class="btn btn-primary w-100" onclick="alertSendSticker()">
								<i class="fa-solid fa-icons"></i> Send Sticker
							</button>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- Button Config Section -->
		<section id="collapseButtons" class="collapse mt-4">
			<div class="card glass-card">
				<div class="card-header border-0 pb-0">
					<div class="d-flex align-items-center gap-3">
						<div class="feature-icon list" style="width: 48px; height: 48px; font-size: 1.2rem;"><i
								class="fa-solid fa-sliders"></i></div>
						<div>
							<h4 class="card-title mb-1">Button Configuration</h4>
							<p class="text-muted mb-0 small">Design your interactive button message.</p>
						</div>
					</div>
				</div>
				<div class="card-body pt-4">
					<div class="row g-3">
						<!-- Session & Target -->
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">SESSION</label>
								<select id="sessionsButton" name="sessions" class="form-select">
									<% if (Array.isArray(session) && session.length) { %>
										<% session.forEach((el, index)=> { %>
											<option>
												<%= el.session_name %> (+<%= el.session_number %>)
											</option>
											<% }) %>
												<% } %>
								</select>
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">TARGET NUMBER</label>
								<input id="targetButton" type="number" name="target" class="form-control"
									placeholder="e.g. 628123456789" required />
							</div>
						</div>

						<!-- Message Content -->
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">CAPTION / MESSAGE</label>
								<textarea id="messageButton" name="message" class="form-control" rows="3"
									placeholder="Enter your message here..."></textarea>
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">FOOTER TEXT</label>
								<input id="textFooterButton" type="text" name="textFooter" class="form-control"
									placeholder="Optional footer text" />
							</div>
						</div>

						<!-- Media (Optional) -->
						<div class="col-12">
							<div class="p-3 rounded-3 bg-light border">
								<h6 class="mb-3 small fw-bold text-muted"><i class="fa-solid fa-image me-2"></i>MEDIA
									HEADER (OPTIONAL)</h6>
								<div class="row g-3">
									<div class="col-md-6">
										<label class="form-label small">Upload Image</label>
										<input type="file" name="fileButton" accept="image/*,video/*"
											class="form-control" />
									</div>
									<div class="col-md-6">
										<label class="form-label small">Image URL</label>
										<input id="urlButton" type="url" name="url" class="form-control"
											placeholder="https://..." />
									</div>
								</div>
							</div>
						</div>

						<!-- Buttons -->
						<div class="col-12">
							<div class="p-3 rounded-3 bg-light border">
								<h6 class="mb-3 small fw-bold text-muted"><i
										class="fa-solid fa-toggle-on me-2"></i>INTERACTIVE BUTTONS</h6>

								<!-- URL Button -->
								<div class="row g-3 mb-3">
									<div class="col-md-6">
										<label class="form-label small">URL Button Text</label>
										<input id="texturlButton" type="text" class="form-control"
											placeholder="Visit Website" />
									</div>
									<div class="col-md-6">
										<label class="form-label small">URL Link</label>
										<input id="responUrlButton" type="url" class="form-control"
											placeholder="https://example.com" />
									</div>
								</div>

								<!-- Call Button -->
								<div class="row g-3 mb-3">
									<div class="col-md-6">
										<label class="form-label small">Call Button Text</label>
										<input id="callButton" type="text" class="form-control"
											placeholder="Call Support" />
									</div>
									<div class="col-md-6">
										<label class="form-label small">Phone Number</label>
										<input id="responCallButton" type="number" class="form-control"
											placeholder="628123456789" />
									</div>
								</div>

								<!-- Regular Buttons -->
								<div class="row g-3">
									<div class="col-md-4">
										<label class="form-label small">Button 1 Text</label>
										<input type="text" name="buttonText" class="form-control mb-2"
											placeholder="Yes" />
										<input type="text" name="btnMessageText" class="form-control form-control-sm"
											placeholder="Reply for Btn 1" />
									</div>
									<div class="col-md-4">
										<label class="form-label small">Button 2 Text</label>
										<input type="text" name="buttonText" class="form-control mb-2"
											placeholder="No" />
										<input type="text" name="btnMessageText" class="form-control form-control-sm"
											placeholder="Reply for Btn 2" />
									</div>
									<div class="col-md-4">
										<label class="form-label small">Button 3 Text</label>
										<input type="text" name="buttonText" class="form-control mb-2"
											placeholder="Maybe" />
										<input type="text" name="btnMessageText" class="form-control form-control-sm"
											placeholder="Reply for Btn 3" />
									</div>
								</div>
							</div>
						</div>

						<div class="col-12 text-end mt-4">
							<button onclick="alertSendButton()" type="submit" class="btn btn-primary px-4">
								<i class="fa-solid fa-paper-plane me-2"></i>Send Button Message
							</button>
						</div>
					</div>
				</div>
			</div>
		</section>

		<!-- List Config Section -->
		<section id="collapseList" class="collapse mt-4">
			<div class="card glass-card">
				<div class="card-header border-0 pb-0">
					<div class="d-flex align-items-center gap-3">
						<div class="feature-icon list" style="width: 48px; height: 48px; font-size: 1.2rem;"><i
								class="fa-solid fa-list-ul"></i></div>
						<div>
							<h4 class="card-title mb-1">List Configuration</h4>
							<p class="text-muted mb-0 small">Create a menu with selectable options.</p>
						</div>
					</div>
				</div>
				<div class="card-body pt-4">
					<div class="row g-3">
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">SESSION</label>
								<select id="sessionsList" name="sessions" class="form-select">
									<% if (Array.isArray(session) && session.length) { %>
										<% session.forEach((el, index)=> { %>
											<option>
												<%= el.session_name %> (+<%= el.session_number %>)
											</option>
											<% }) %>
												<% } %>
								</select>
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">TARGET NUMBER</label>
								<input id="targetList" type="number" name="target" class="form-control"
									placeholder="e.g. 628123456789" required />
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">MENU TITLE</label>
								<input id="titleList" type="text" name="title" class="form-control"
									placeholder="Main Menu" required />
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">MENU BODY</label>
								<input id="bodyList" type="text" name="body" class="form-control"
									placeholder="Please select an option below" required />
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">FOOTER TEXT</label>
								<input id="footerList" type="text" name="footer" class="form-control"
									placeholder="Powered by WA Gateway" required />
							</div>
						</div>
						<div class="col-md-6 col-12">
							<div class="form-group">
								<label class="form-label small fw-bold text-muted">BUTTON LABEL</label>
								<input id="buttonList" type="text" name="button" class="form-control"
									placeholder="Click to View Menu" required />
							</div>
						</div>
					</div>

					<h6 class="mt-4 mb-3 small fw-bold text-muted">MENU OPTIONS</h6>
					<div class="table-responsive rounded-3 border">
						<table class="table table-hover mb-0" id="table1">
							<thead class="bg-light">
								<tr>
									<th class="px-3 py-2">#</th>
									<th class="px-3 py-2">Option Title</th>
									<th class="px-3 py-2">Description</th>
									<th class="px-3 py-2">Reply ID (Hidden)</th>
								</tr>
							</thead>
							<tbody>
								<% for( let i=0; i < 5; i++ ) { %>
									<tr>
										<td class="px-3 align-middle">
											<%= i+1 %>
										</td>
										<td class="px-3"><input type="text" name="titleRow"
												class="form-control form-control-sm" placeholder="Option <%= i+1 %>" />
										</td>
										<td class="px-3"><input type="text" name="descRow"
												class="form-control form-control-sm" placeholder="Description..." />
										</td>
										<td class="px-3"><input type="text" name="respRow"
												class="form-control form-control-sm" placeholder="id_<%= i+1 %>" /></td>
									</tr>
									<% } %>
							</tbody>
						</table>
					</div>
					<div class="text-end mt-4">
						<button onclick="alertSendList()" class="btn btn-primary px-4">
							<i class="fa-solid fa-paper-plane me-2"></i>Send List Message
						</button>
					</div>
				</div>
			</div>
		</section>
</div>

<script>
	// Helper for SweetAlert defaults
	const swalConfig = {
		customClass: {
			confirmButton: 'btn btn-primary me-2',
			cancelButton: 'btn btn-light',
			popup: 'glass-card border-0'
		},
		buttonsStyling: false
	};

	async function alertSendText() {
		const htmlSwal = `
			<div class="text-start">
				<div class="form-group mb-3">
					<label class="form-label small fw-bold text-muted">SESSION</label>
					<select id="sessionText" class="form-select">
						<% if (Array.isArray(session) && session.length) { %> 
							<% session.forEach((el) => { %>
								<option value="<%= el.session_name %>"><%= el.session_name %> (+<%= el.session_number %>)</option>
							<% }) %> 
						<% } %>
					</select>
				</div>
				<div class="form-group mb-3">
					<label class="form-label small fw-bold text-muted">TARGET NUMBER</label>
					<input id="targetText" type="number" class="form-control" placeholder="628123456789" />
				</div>
				<div class="form-group mb-0">
					<label class="form-label small fw-bold text-muted">MESSAGE</label>
					<textarea id="messageText" class="form-control" rows="4" placeholder="Type your message..."></textarea>
				</div>
			</div>
		`;

		Swal.fire({
			...swalConfig,
			title: 'Send Text Message',
			html: htmlSwal,
			showCancelButton: true,
			confirmButtonText: '<i class="fa-solid fa-paper-plane"></i> Send',
			preConfirm: () => {
				const data = {
					sessions: document.getElementById("sessionText").value,
					target: document.getElementById("targetText").value,
					message: document.getElementById("messageText").value,
				};
				if (!data.sessions || !data.target || !data.message) {
					Swal.showValidationMessage('Please fill all fields');
					return false;
				}
				return fetch(`/api/sendtext`, {
					method: "POST",
					body: JSON.stringify(data),
					headers: { "Content-Type": "application/json" },
				}).then(res => {
					if (!res.ok) throw new Error(res.statusText);
					return res.json();
				}).catch(err => {
					Swal.showValidationMessage(`Error: ${err}`);
				});
			}
		}).then((result) => {
			if (result.isConfirmed) {
				const res = result.value;
				Swal.fire({
					...swalConfig,
					icon: res.status === 200 ? 'success' : 'error',
					title: res.status === 200 ? 'Sent!' : 'Failed',
					text: JSON.stringify(res.message)
				});
			}
		});
	}

	async function alertSendMedia() {
		const htmlSwal = `
			<div class="text-start">
				<div class="form-group mb-3">
					<label class="form-label small fw-bold text-muted">SESSION</label>
					<select id="sessionMedia" class="form-select">
						<% if (Array.isArray(session) && session.length) { %> 
							<% session.forEach((el) => { %>
								<option value="<%= el.session_name %>"><%= el.session_name %> (+<%= el.session_number %>)</option>
							<% }) %> 
						<% } %>
					</select>
				</div>
				<div class="form-group mb-3">
					<label class="form-label small fw-bold text-muted">TARGET NUMBER</label>
					<input id="targetMedia" type="number" class="form-control" placeholder="628123456789" />
				</div>
				<div class="form-group mb-3">
					<label class="form-label small fw-bold text-muted">MEDIA SOURCE</label>
					<div class="nav nav-pills mb-2" role="tablist">
						<button class="nav-link active py-1 px-3 small" data-bs-toggle="pill" data-bs-target="#file-upload" type="button">File Upload</button>
						<button class="nav-link py-1 px-3 small" data-bs-toggle="pill" data-bs-target="#url-upload" type="button">URL</button>
					</div>
					<div class="tab-content">
						<div class="tab-pane fade show active" id="file-upload">
							<input type="file" name="fileMedia" class="form-control" />
						</div>
						<div class="tab-pane fade" id="url-upload">
							<input type="url" id="urlMedia" class="form-control" placeholder="https://example.com/image.jpg" />
						</div>
					</div>
				</div>
				<div class="form-group mb-0">
					<label class="form-label small fw-bold text-muted">CAPTION (OPTIONAL)</label>
					<textarea id="messageMedia" class="form-control" rows="2" placeholder="Caption..."></textarea>
				</div>
			</div>
		`;

		Swal.fire({
			...swalConfig,
			title: 'Send Media',
			html: htmlSwal,
			showCancelButton: true,
			confirmButtonText: '<i class="fa-solid fa-paper-plane"></i> Send',
			preConfirm: () => {
				const fileInput = document.querySelector('input[name="fileMedia"]');
				const session = document.getElementById("sessionMedia").value;
				const target = document.getElementById("targetMedia").value;
				const message = document.getElementById("messageMedia").value;
				const url = document.getElementById("urlMedia").value;

				if (!target) {
					Swal.showValidationMessage('Target number is required');
					return false;
				}

				if (fileInput.files[0]) {
					const formData = new FormData();
					formData.append("file", fileInput.files[0]);
					formData.append("sessions", session);
					formData.append("target", target);
					formData.append("message", message);
					return fetch(`/api/sendmedia`, { method: "POST", body: formData })
						.then(res => res.json());
				} else if (url) {
					return fetch(`/api/sendmedia`, {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ sessions: session, target, message, url })
					}).then(res => res.json());
				} else {
					Swal.showValidationMessage('Please provide a file or URL');
					return false;
				}
			}
		}).then((result) => {
			if (result.isConfirmed) {
				const res = result.value;
				Swal.fire({
					...swalConfig,
					icon: res.status === 200 ? 'success' : 'error',
					title: res.status === 200 ? 'Sent!' : 'Failed',
					text: JSON.stringify(res.message)
				});
			}
		});
	}

	async function alertSendLocation() {
		// Implementation for location...
		// Simplified for brevity, following same pattern
		Swal.fire({
			...swalConfig,
			title: 'Send Location',
			html: `
				<div class="text-start">
					<div class="form-group mb-3">
						<label class="form-label small fw-bold text-muted">SESSION</label>
						<select id="sessionLoc" class="form-select">
							<% if (Array.isArray(session) && session.length) { %> 
								<% session.forEach((el) => { %> <option value="<%= el.session_name %>"><%= el.session_name %></option> <% }) %> 
							<% } %>
						</select>
					</div>
					<div class="form-group mb-3">
						<label class="form-label small fw-bold text-muted">TARGET</label>
						<input id="targetLoc" type="number" class="form-control" placeholder="628..." />
					</div>
					<div class="row g-2">
						<div class="col-6">
							<label class="form-label small fw-bold text-muted">LATITUDE</label>
							<input id="latLoc" type="text" class="form-control" placeholder="-6.200000" />
						</div>
						<div class="col-6">
							<label class="form-label small fw-bold text-muted">LONGITUDE</label>
							<input id="longLoc" type="text" class="form-control" placeholder="106.816666" />
						</div>
					</div>
				</div>
			`,
			showCancelButton: true,
			confirmButtonText: 'Send',
			preConfirm: () => {
				const data = {
					sessions: document.getElementById("sessionLoc").value,
					target: document.getElementById("targetLoc").value,
					latitude: document.getElementById("latLoc").value,
					longitude: document.getElementById("longLoc").value
				};
				return fetch(`/api/sendlocation`, {
					method: "POST",
					body: JSON.stringify(data),
					headers: { "Content-Type": "application/json" }
				}).then(res => res.json());
			}
		}).then(result => {
			if (result.isConfirmed) Swal.fire({ ...swalConfig, icon: 'success', title: 'Result', text: JSON.stringify(result.value) });
		});
	}

	async function alertSendContact() {
		// Implementation for contact...
		Swal.fire({
			...swalConfig,
			title: 'Send Contact',
			html: `
				<div class="text-start">
					<div class="form-group mb-3">
						<select id="sessionContact" class="form-select">
							<% if (Array.isArray(session) && session.length) { %> 
								<% session.forEach((el) => { %> <option value="<%= el.session_name %>"><%= el.session_name %></option> <% }) %> 
							<% } %>
						</select>
					</div>
					<div class="form-group mb-3">
						<input id="targetContact" type="number" class="form-control" placeholder="Target: 628..." />
					</div>
					<div class="form-group mb-3">
						<input id="contactName" type="text" class="form-control" placeholder="Contact Name: John Doe" />
					</div>
					<div class="form-group mb-3">
						<input id="contactNumber" type="number" class="form-control" placeholder="Contact Phone: 628..." />
					</div>
				</div>
			`,
			showCancelButton: true,
			confirmButtonText: 'Send',
			preConfirm: () => {
				const data = {
					sessions: document.getElementById("sessionContact").value,
					target: document.getElementById("targetContact").value,
					contactName: document.getElementById("contactName").value,
					contact: document.getElementById("contactNumber").value
				};
				return fetch(`/api/sendcontact`, {
					method: "POST",
					body: JSON.stringify(data),
					headers: { "Content-Type": "application/json" }
				}).then(res => res.json());
			}
		}).then(result => {
			if (result.isConfirmed) Swal.fire({ ...swalConfig, icon: 'success', title: 'Result', text: JSON.stringify(result.value) });
		});
	}

	async function alertSendSticker() {
		const htmlSwal = `
			<div class="text-start">
				<div class="form-group mb-3">
					<select id="sessionSticker" class="form-select">
						<% if (Array.isArray(session) && session.length) { %> 
							<% session.forEach((el) => { %> <option value="<%= el.session_name %>"><%= el.session_name %></option> <% }) %> 
						<% } %>
					</select>
				</div>
				<div class="form-group mb-3">
					<input id="targetSticker" type="number" class="form-control" placeholder="Target: 628..." />
				</div>
				<div class="form-group mb-3">
					<input type="file" name="fileSticker" class="form-control" />
				</div>
				<div class="row g-2">
					<div class="col-6">
						<input id="packname" type="text" class="form-control" placeholder="Pack Name" value="WA Gateway" />
					</div>
					<div class="col-6">
						<input id="author" type="text" class="form-control" placeholder="Author" value="Bot" />
					</div>
				</div>
			</div>
		`;

		Swal.fire({
			...swalConfig,
			title: 'Send Sticker',
			html: htmlSwal,
			showCancelButton: true,
			confirmButtonText: 'Send',
			preConfirm: () => {
				const fileInput = document.querySelector('input[name="fileSticker"]');
				const formData = new FormData();
				formData.append("file", fileInput.files[0]);
				formData.append("sessions", document.getElementById("sessionSticker").value);
				formData.append("target", document.getElementById("targetSticker").value);
				formData.append("packname", document.getElementById("packname").value);
				formData.append("author", document.getElementById("author").value);

				return fetch(`/api/sendsticker`, { method: "POST", body: formData }).then(res => res.json());
			}
		}).then(result => {
			if (result.isConfirmed) Swal.fire({ ...swalConfig, icon: 'success', title: 'Result', text: JSON.stringify(result.value) });
		});
	}

	async function alertSendButton() {
		// Existing logic adapted...
		// For brevity, keeping the core logic but ensuring it grabs values from the new form layout
		// The form is now in the main page body, not a Swal, so we just submit directly

		let arrayButton = [];
		document.getElementsByName("buttonText").forEach(el => { if (el.value) arrayButton.push(el.value) });

		let arrayButton2 = [];
		document.getElementsByName("btnMessageText").forEach(el => { if (el.value) arrayButton2.push(el.value) });

		const fileInput = document.querySelector('input[name="fileButton"]');
		const session = document.getElementById("sessionsButton").value;
		const target = document.getElementById("targetButton").value;
		const message = document.getElementById("messageButton").value;

		if (!target || !message) {
			return Swal.fire({ ...swalConfig, icon: 'warning', title: 'Validation', text: 'Target and Message are required' });
		}

		let body;
		let headers = {};

		if (fileInput && fileInput.files[0]) {
			const form = new FormData();
			form.append("file", fileInput.files[0]);
			form.append("sessions", session);
			form.append("target", target);
			form.append("message", message);
			form.append("textFooter", document.getElementById("textFooterButton").value);
			form.append("urlButton", document.getElementById("texturlButton").value);
			form.append("responUrl", document.getElementById("responUrlButton").value);
			form.append("callButton", document.getElementById("callButton").value);
			form.append("responCall", document.getElementById("responCallButton").value);
			arrayButton.forEach(val => form.append("button", val));
			arrayButton2.forEach(val => form.append("btnMessage", val));
			body = form;
		} else {
			body = JSON.stringify({
				sessions: session,
				target: target,
				message: message,
				textFooter: document.getElementById("textFooterButton").value,
				url: document.getElementById("urlButton").value,
				urlButton: document.getElementById("texturlButton").value,
				responUrl: document.getElementById("responUrlButton").value,
				callButton: document.getElementById("callButton").value,
				responCall: document.getElementById("responCallButton").value,
				button: arrayButton,
				btnMessage: arrayButton2,
			});
			headers = { "Content-Type": "application/json" };
		}

		try {
			const res = await fetch(`/api/sendbutton`, { method: "POST", body, headers });
			const result = await res.json();
			Swal.fire({ ...swalConfig, icon: 'success', title: 'Result', text: JSON.stringify(result.message) });
		} catch (e) {
			Swal.fire({ ...swalConfig, icon: 'error', title: 'Error', text: e.message });
		}
	}

	async function alertSendList() {
		// Similar adaptation for List
		let titleRow = [];
		document.getElementsByName("titleRow").forEach(el => { if (el.value) titleRow.push(el.value) });
		let descRow = [];
		document.getElementsByName("descRow").forEach(el => { if (el.value) descRow.push(el.value) });
		let respRow = [];
		document.getElementsByName("respRow").forEach(el => { if (el.value) respRow.push(el.value) });

		const data = {
			sessions: document.getElementById("sessionsList").value,
			target: document.getElementById("targetList").value,
			title: document.getElementById("titleList").value,
			body: document.getElementById("bodyList").value,
			footer: document.getElementById("footerList").value,
			button: document.getElementById("buttonList").value,
			titleRow, descRow, respRow
		};

		try {
			const res = await fetch(`/api/sendlist`, {
				method: "POST",
				body: JSON.stringify(data),
				headers: { "Content-Type": "application/json" }
			});
			const result = await res.json();
			Swal.fire({ ...swalConfig, icon: 'success', title: 'Result', text: JSON.stringify(result.message) });
		} catch (e) {
			Swal.fire({ ...swalConfig, icon: 'error', title: 'Error', text: e.message });
		}
	}
</script>